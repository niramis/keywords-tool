{"ast":null,"code":"var _jsxFileName = \"G:\\\\kloud9\\\\dashboard-last\\\\keywords-tool\\\\client\\\\src\\\\App.js\";\nimport React from 'react';\nimport Header from \"./components/Header\";\nimport Input from './components/Input';\nimport KeywordPlot from './components/plot/index.js';\nimport { appConfig } from './config.js';\nimport { get_min_value, get_max_value, capitalizeString } from './components/plot/src/plot/utils/functions';\nimport Loader from \"react-loader-spinner\";\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport './styles/styles.css';\nlet dimensions = appConfig.dimensions;\nconst MA_Day_5 = \"5 Day MA for \";\nconst LOWER_BAND = \"Lower Band for \";\nconst UPPER_BAND = \"Upper Band for \";\nconst ratio = 4.5;\nconst SECONDS_NUMBER = 60;\n\nclass App extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.fetchCallback = (keywords, selected_state_name, selected_time_frame) => {\n      this.setState({\n        displayResults: false,\n        region_state: selected_state_name.toUpperCase()\n      });\n      this.fetchData(keywords, selected_state_name, selected_time_frame);\n    };\n\n    this.errorCallback = message => {\n      this.setState({\n        displayError: true,\n        error_message: message\n      });\n      window.setTimeout(() => {\n        this.setState({\n          displayError: false\n        });\n      }, 2000);\n    };\n\n    this.mapCallback = state => {\n      this.setState({\n        displayResults: false,\n        region_state: state.toUpperCase()\n      });\n      this.fetchData(this.state.keywords, state, this.state.selected_time_frame);\n    };\n\n    this.handleMouseMove = () => {\n      this.timer = 0;\n      this.setState({\n        seconds: SECONDS_NUMBER\n      });\n    };\n\n    this.updateWindowDimensions = this.updateWindowDimensions.bind(this);\n    this.handleMouseMove = this.handleMouseMove.bind(this); // this.handleHoverOff = this.handleHoverOff.bind(this);\n    // this.timer = 0;\n    // this.startTimer = this.startTimer.bind(this);\n    // this.countDown = this.countDown.bind(this);\n\n    this.state = {\n      username: \"user\",\n      displayResults: false,\n      fetching_results: false,\n      displayError: false,\n      region_state: \"US\",\n      selected_time_frame: \"today 5-y\",\n      keywords: [],\n      data: [],\n      error_message: \"\",\n      time: {} // seconds: SECONDS_NUMBER,\n\n    };\n    this.myRef = React.createRef();\n  }\n\n  fetchData(keywords, state, selected_time_frame) {\n    let url = \"/data\"; // let url = appConfig.KEYWORDS_DATA2\n\n    this.setState({\n      fetching_results: true,\n      keywords: keywords\n    });\n    fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-type': 'application/json'\n      },\n      body: JSON.stringify({\n        keywords: keywords,\n        region_state: state,\n        time_frame: selected_time_frame\n      })\n    }).then(res => res.json()).then(result => {\n      let width = this.myRef.current.offsetWidth;\n      let sizes = this.get_dimensions(width);\n      this.setState({\n        keywords: keywords,\n        displayResults: true,\n        fetching_results: false,\n        region_state: state.toUpperCase(),\n        selected_time_frame: selected_time_frame,\n        data: this.get_data2(keywords, result),\n        div_height: sizes.height,\n        width: width\n      });\n    }).catch(function (error) {\n      console.log(error);\n    });\n  }\n\n  componentDidMount() {\n    this.updateWindowDimensions();\n    window.addEventListener('resize', this.updateWindowDimensions);\n    this.myRef.current.focus(); // let timeLeftVar = this.secondsToTime(this.state.seconds);\n    // this.setState({ time: timeLeftVar });\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this.updateWindowDimensions);\n  }\n\n  updateWindowDimensions() {\n    let width = this.myRef.current.offsetWidth;\n    let sizes = this.get_dimensions(width);\n    this.setState({\n      div_height: sizes.height,\n      width: width\n    });\n  }\n\n  render() {\n    let plot_settings = {\n      title: \"Trends Forecast\",\n      x_label: \"Date\",\n      y_label: \"Search interest (%)\",\n      number_of_series: this.state.keywords.length,\n      keywords: this.state.keywords,\n      height: this.state.div_height,\n      width: this.state.width\n    };\n    return React.createElement(\"div\", {\n      ref: this.myRef,\n      onMouseMove: this.handleMouseMove,\n      onMouseLeave: this.handleHoverOff,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"main_results\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184\n      },\n      __self: this\n    }, React.createElement(Header, {\n      username: this.state.username,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185\n      },\n      __self: this\n    }), React.createElement(Input, {\n      callbackFromParent: this.fetchCallback,\n      errorTimeframeCallback: this.errorCallback,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186\n      },\n      __self: this\n    }), this.state.displayError ? React.createElement(\"div\", {\n      className: \"error_message\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188\n      },\n      __self: this\n    }, this.state.error_message) : React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188\n      },\n      __self: this\n    }, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188\n      },\n      __self: this\n    })), this.state.displayResults ? React.createElement(\"div\", {\n      className: \"content\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 192\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"results_div\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193\n      },\n      __self: this\n    }, React.createElement(KeywordPlot, {\n      plot_settings: plot_settings,\n      data: this.state.data,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196\n      },\n      __self: this\n    }))) : React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202\n      },\n      __self: this\n    }, this.state.fetching_results ? React.createElement(\"div\", {\n      className: \"spinner\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207\n      },\n      __self: this\n    }, React.createElement(Loader, {\n      type: \"Oval\",\n      color: \"#1694d0\",\n      height: 200,\n      width: 200,\n      timeout: 30000,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208\n      },\n      __self: this\n    })) : React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210\n      },\n      __self: this\n    }))));\n  }\n\n  get_data(keywords, result) {\n    let historical_data = [];\n    let forecasted_data = [];\n\n    for (let keyword in keywords) {\n      let index = 0;\n      let k_w = keywords[keyword];\n      let length = Object.keys(result[k_w]).length - 60;\n      console.log(Object.keys(result[k_w]).length);\n      let arr = Object.keys(result[k_w]).map(function (key) {\n        if (result[k_w][key] !== null) {\n          if (index < 4) {\n            return [index++, new Date(key).valueOf(), result[k_w][key], result[LOWER_BAND + k_w][key], result[UPPER_BAND + k_w][key]];\n          } else {\n            return [index++, new Date(key).valueOf(), result[MA_Day_5 + k_w][key], result[LOWER_BAND + k_w][key], result[UPPER_BAND + k_w][key]];\n          }\n        }\n      });\n      historical_data.push(arr.slice(0, index));\n      arr = Object.keys(result[keywords[keyword] + \"F\"]).map(function (key) {\n        if (index < 4) {\n          return [index++, new Date(key).valueOf(), result[keywords[keyword] + \"F\"][key], result[LOWER_BAND + k_w + \"F\"][key], result[UPPER_BAND + k_w + \"F\"][key]];\n        } else {\n          return [index++, new Date(key).valueOf(), result[MA_Day_5 + k_w + \"F\"][key], result[LOWER_BAND + k_w + \"F\"][key], result[UPPER_BAND + k_w + \"F\"][key]];\n        }\n      });\n      forecasted_data.push(arr.slice(length, length + 52));\n    }\n\n    return {\n      historical_data: historical_data,\n      forecasted_data: forecasted_data\n    };\n  }\n\n  get_data2(keywords, result) {\n    let historical_data = [];\n    let forecasted_data = [];\n\n    for (let keyword in keywords) {\n      let index = 0;\n      let k_w = keywords[keyword];\n      let length = Object.keys(result.historical_data).length;\n      let arr = Object.keys(result.historical_data).map(function (key) {\n        if (result.historical_data[key] !== null) {\n          if (index < 4) {\n            return [index++, new Date(key).valueOf(), result.historical_data[key][k_w].value, result.historical_data[key][k_w].L_B, result.historical_data[key][k_w].U_B];\n          } else {\n            return [index++, new Date(key).valueOf(), result.historical_data[key][k_w].M_A, result.historical_data[key][k_w].L_B, result.historical_data[key][k_w].U_B];\n          }\n        }\n      });\n      historical_data.push(arr.slice(0, index));\n      arr = Object.keys(result.forecasted_data).map(function (key) {\n        if (index < 4) {\n          return [index++, new Date(key).valueOf(), result.forecasted_data[key][k_w].value, result.forecasted_data[key][k_w].L_B, result.forecasted_data[key][k_w].U_B];\n        } else {\n          return [index++, new Date(key).valueOf(), result.forecasted_data[key][k_w].M_A, result.forecasted_data[key][k_w].L_B, result.forecasted_data[key][k_w].U_B];\n        }\n      });\n      forecasted_data.push(arr.slice(length, length + 52));\n    }\n\n    return {\n      historical_data: historical_data,\n      forecasted_data: forecasted_data\n    };\n  }\n\n  get_dimensions(width) {\n    let height = width / ratio;\n\n    if (width > 1800) {\n      height = height;\n    }\n\n    if (width <= 1800) {\n      height = 1.2 * width / ratio;\n    }\n\n    if (width <= 1600) {\n      height = 1.4 * width / ratio;\n    }\n\n    if (width <= 1400) {\n      height = 1.7 * width / ratio;\n    }\n\n    if (width <= 1200) {\n      height = 2.2 * width / ratio;\n    }\n\n    if (width <= 700) {\n      height = 3.4 * width / ratio;\n    }\n\n    let sizes = {\n      height: height\n    };\n    return sizes;\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["G:/kloud9/dashboard-last/keywords-tool/client/src/App.js"],"names":["React","Header","Input","KeywordPlot","appConfig","get_min_value","get_max_value","capitalizeString","Loader","dimensions","MA_Day_5","LOWER_BAND","UPPER_BAND","ratio","SECONDS_NUMBER","App","PureComponent","constructor","props","fetchCallback","keywords","selected_state_name","selected_time_frame","setState","displayResults","region_state","toUpperCase","fetchData","errorCallback","message","displayError","error_message","window","setTimeout","mapCallback","state","handleMouseMove","timer","seconds","updateWindowDimensions","bind","username","fetching_results","data","time","myRef","createRef","url","fetch","method","headers","body","JSON","stringify","time_frame","then","res","json","result","width","current","offsetWidth","sizes","get_dimensions","get_data2","div_height","height","catch","error","console","log","componentDidMount","addEventListener","focus","componentWillUnmount","removeEventListener","render","plot_settings","title","x_label","y_label","number_of_series","length","handleHoverOff","get_data","historical_data","forecasted_data","keyword","index","k_w","Object","keys","arr","map","key","Date","valueOf","push","slice","value","L_B","U_B","M_A"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport Header from \"./components/Header\"\r\nimport Input from './components/Input'\r\n\r\nimport KeywordPlot from './components/plot/index.js';\r\nimport { appConfig } from './config.js';\r\nimport { get_min_value, get_max_value, capitalizeString } from './components/plot/src/plot/utils/functions';\r\n\r\nimport Loader from \"react-loader-spinner\";\r\nimport 'bootstrap/dist/css/bootstrap.min.css';\r\nimport './styles/styles.css';\r\n\r\nlet dimensions = appConfig.dimensions;\r\n\r\nconst MA_Day_5 = \"5 Day MA for \";\r\nconst LOWER_BAND = \"Lower Band for \";\r\nconst UPPER_BAND = \"Upper Band for \";\r\n\r\n\r\nconst ratio = 4.5;\r\n\r\nconst SECONDS_NUMBER = 60;\r\n\r\nclass App extends React.PureComponent {\r\n  \r\n    constructor(props){\r\n      super(props);\r\n      this.updateWindowDimensions = this.updateWindowDimensions.bind(this);\r\n      this.handleMouseMove = this.handleMouseMove.bind(this);\r\n      // this.handleHoverOff = this.handleHoverOff.bind(this);\r\n\r\n      // this.timer = 0;\r\n      // this.startTimer = this.startTimer.bind(this);\r\n      // this.countDown = this.countDown.bind(this);\r\n\r\n      this.state = {\r\n        username: \"user\",\r\n        displayResults: false,\r\n        fetching_results: false,\r\n        displayError: false,\r\n\r\n        region_state: \"US\",\r\n        selected_time_frame: \"today 5-y\",\r\n        keywords: [],\r\n        data: [],\r\n\r\n        \r\n        error_message: \"\",\r\n        \r\n        time: {},\r\n        // seconds: SECONDS_NUMBER,\r\n      };\r\n\r\n      this.myRef = React.createRef();\r\n\r\n    }\r\n\r\n    fetchCallback = (keywords, selected_state_name, selected_time_frame) => {\r\n      this.setState({\r\n          displayResults: false,\r\n          region_state: selected_state_name.toUpperCase(),\r\n      });\r\n\r\n      this.fetchData(keywords, selected_state_name, selected_time_frame)\r\n    }\r\n\r\n    errorCallback = (message) => {\r\n\r\n      this.setState({\r\n        displayError: true,\r\n        error_message: message,\r\n      });\r\n\r\n      window.setTimeout(() => {\r\n        this.setState({\r\n          displayError: false\r\n        });\r\n      }, 2000);\r\n\r\n    }\r\n\r\n    mapCallback = (state) => {\r\n\r\n      this.setState({\r\n        displayResults: false,\r\n        region_state: state.toUpperCase(),\r\n      });\r\n\r\n      this.fetchData(this.state.keywords, state, this.state.selected_time_frame)\r\n    }\r\n\r\n    fetchData(keywords, state, selected_time_frame){\r\n\r\n      let url = \"/data\"\r\n      // let url = appConfig.KEYWORDS_DATA2\r\n\r\n      this.setState({\r\n        fetching_results: true,\r\n        keywords: keywords\r\n      })\r\n\r\n      fetch(url, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-type':'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          keywords: keywords, region_state: state, time_frame: selected_time_frame\r\n        }),\r\n      }).then(res => res.json())\r\n        .then(\r\n        (result) => {\r\n          let width = this.myRef.current.offsetWidth;\r\n          let sizes = this.get_dimensions(width);\r\n\r\n          this.setState({\r\n            keywords: keywords,\r\n            displayResults: true,\r\n            fetching_results: false,\r\n\r\n            region_state: state.toUpperCase(),\r\n            selected_time_frame: selected_time_frame,\r\n\r\n            data: this.get_data2(keywords, result),\r\n            \r\n            div_height: sizes.height,\r\n            width: width,\r\n          });\r\n        }).catch(function(error) {\r\n        console.log(error)\r\n        })\r\n      }\r\n\r\n    componentDidMount() {\r\n      this.updateWindowDimensions();\r\n      window.addEventListener('resize', this.updateWindowDimensions);\r\n      this.myRef.current.focus();\r\n\r\n      // let timeLeftVar = this.secondsToTime(this.state.seconds);\r\n      // this.setState({ time: timeLeftVar });\r\n\r\n    }\r\n\r\n    componentWillUnmount() {\r\n      window.removeEventListener('resize', this.updateWindowDimensions);\r\n    }\r\n   \r\n    updateWindowDimensions() {\r\n      let width = this.myRef.current.offsetWidth;\r\n      let sizes = this.get_dimensions(width);\r\n\r\n      this.setState({\r\n        div_height: sizes.height,\r\n        width: width,\r\n      });\r\n    }\r\n\r\n\r\n    handleMouseMove= () => {\r\n      this.timer = 0;\r\n      this.setState({\r\n        seconds: SECONDS_NUMBER,\r\n      });\r\n    }\r\n\r\n    render() {\r\n\r\n      let plot_settings = {\r\n        title: \"Trends Forecast\",\r\n        x_label: \"Date\",\r\n        y_label: \"Search interest (%)\",\r\n\r\n        number_of_series: this.state.keywords.length,\r\n        keywords: this.state.keywords,\r\n\r\n        height: this.state.div_height,\r\n        width: this.state.width\r\n\r\n      }\r\n\r\n        return (\r\n          <div ref={this.myRef} onMouseMove={this.handleMouseMove} onMouseLeave={this.handleHoverOff}>\r\n            \r\n            <div className=\"main_results\">\r\n              <Header username={this.state.username} />\r\n              <Input callbackFromParent={this.fetchCallback} errorTimeframeCallback={this.errorCallback} />\r\n\r\n              { (this.state.displayError) ? (<div className=\"error_message\">{this.state.error_message}</div>) : (<div><br/></div>)}\r\n\r\n            { (this.state.displayResults) ? (\r\n            \r\n            <div className=\"content\">\r\n              <div className=\"results_div\">\r\n\r\n                {/* <div id=\"plot_div\">  */}\r\n                  <KeywordPlot plot_settings={plot_settings} data={this.state.data} />\r\n                {/* </div> */}\r\n              </div>\r\n\r\n            </div>  ) : (\r\n            \r\n            <div>\r\n              {/* <div className=\"intro\">\r\n\r\n              </div> */}\r\n              {this.state.fetching_results ? (    \r\n                <div className=\"spinner\">\r\n                  <Loader type=\"Oval\" color=\"#1694d0\" height={200} width={200} timeout={30000} />\r\n                </div>   \r\n                ) : (<div></div>) }\r\n            </div>\r\n            )\r\n          }\r\n\r\n          </div>\r\n        </div>\r\n      );\r\n      \r\n    }\r\n    \r\n      get_data(keywords, result) {\r\n        let historical_data = []\r\n        let forecasted_data = []\r\n\r\n        for (let keyword in keywords) {  \r\n          let index = 0;\r\n          let k_w = keywords[keyword]\r\n          let length = Object.keys(result[k_w]).length - 60;\r\n          console.log(Object.keys(result[k_w]).length)\r\n          \r\n          let arr = Object.keys(result[k_w]).map(\r\n            function(key) {\r\n              if(result[k_w][key] !== null){\r\n                if (index < 4) {\r\n                  return [index++, new Date(key).valueOf(), result[k_w][key], result[LOWER_BAND+k_w][key], result[UPPER_BAND+k_w][key]]\r\n                } else {\r\n                  return [index++, new Date(key).valueOf(), result[MA_Day_5+k_w][key], result[LOWER_BAND+k_w][key], result[UPPER_BAND+k_w][key]]\r\n                }\r\n              } \r\n            }\r\n          );\r\n\r\n          historical_data.push(arr.slice(0, index))\r\n\r\n          arr = Object.keys(result[keywords[keyword] + \"F\"]).map(\r\n            function(key) {\r\n              if (index < 4) {\r\n                return [index++, new Date(key).valueOf(), result[keywords[keyword] + \"F\"][key], result[LOWER_BAND+k_w+ \"F\"][key], result[UPPER_BAND + k_w + \"F\"][key]]            \r\n              } else {\r\n                return [index++, new Date(key).valueOf(), result[MA_Day_5 + k_w + \"F\"][key], result[LOWER_BAND + k_w + \"F\"][key], result[UPPER_BAND + k_w + \"F\"][key]]\r\n              }\r\n            }\r\n          );\r\n\r\n          forecasted_data.push(arr.slice(length, length + 52))\r\n        }\r\n\r\n        return {\r\n          historical_data: historical_data,\r\n          forecasted_data: forecasted_data\r\n        }\r\n\r\n      }\r\n\r\n      get_data2(keywords, result) {\r\n        let historical_data = []\r\n        let forecasted_data = []\r\n\r\n        for (let keyword in keywords) {  \r\n          let index = 0;\r\n          let k_w = keywords[keyword]\r\n          let length = Object.keys(result.historical_data).length\r\n\r\n          \r\n          let arr = Object.keys(result.historical_data).map(\r\n            function(key) {\r\n              if(result.historical_data[key] !== null){\r\n                if (index < 4) {\r\n                  return [index++, new Date(key).valueOf(), result.historical_data[key][k_w].value, result.historical_data[key][k_w].L_B, result.historical_data[key][k_w].U_B]\r\n                } else {\r\n                  return [index++, new Date(key).valueOf(), result.historical_data[key][k_w].M_A, result.historical_data[key][k_w].L_B, result.historical_data[key][k_w].U_B]\r\n                }\r\n              } \r\n            }\r\n          );\r\n  \r\n          historical_data.push(arr.slice(0, index))\r\n  \r\n          arr = Object.keys(result.forecasted_data).map(\r\n            function(key) {\r\n              if (index < 4) {\r\n                return [index++, new Date(key).valueOf(), result.forecasted_data[key][k_w].value, result.forecasted_data[key][k_w].L_B, result.forecasted_data[key][k_w].U_B]\r\n              } else {\r\n                return [index++, new Date(key).valueOf(), result.forecasted_data[key][k_w].M_A, result.forecasted_data[key][k_w].L_B, result.forecasted_data[key][k_w].U_B]\r\n              }\r\n            }\r\n          );\r\n  \r\n          forecasted_data.push(arr.slice(length, length + 52))\r\n        }\r\n\r\n        return {\r\n          historical_data: historical_data,\r\n          forecasted_data: forecasted_data\r\n        }\r\n  \r\n      }\r\n\r\n  get_dimensions(width) {\r\n    let height = width/(ratio);\r\n\r\n    if (width>1800) {\r\n      height = height;\r\n    }\r\n\r\n    if (width<=1800) {\r\n      height = (1.2)*width/(ratio);\r\n    }\r\n\r\n    if (width<=1600) {\r\n      height = (1.4)*width/(ratio);\r\n    }\r\n    \r\n    if (width<=1400) {\r\n      height = (1.7)*width/(ratio);\r\n    }\r\n\r\n    if (width<=1200) {\r\n      height = (2.2)*width/(ratio);\r\n    }\r\n\r\n    if (width<=700) {\r\n      height = (3.4)*width/(ratio);\r\n    }\r\n\r\n    let sizes = {\r\n      height: height,\r\n    }\r\n\r\n    return sizes;\r\n  }\r\n}\r\n  \r\n  \r\nexport default App;\r\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"var _jsxFileName = \"G:\\\\kloud9\\\\dashboard-last\\\\trends-tool\\\\client\\\\src\\\\App.js\";\nimport React from 'react';\nimport Header from \"./components/Header\";\nimport Input from './components/Input';\nimport Login from './components/Login';\nimport Table from './components/Table';\nimport TableGrowth from './components/TableGrowth';\nimport Chart from './components/Chart';\nimport Footer from './components/Footer';\nimport KeywordPlot from './components/plot/index.js';\nimport { appConfig } from './config.js';\nimport { get_min_value, get_max_value, capitalizeString } from './components/plot/src/plot/utils/functions';\nimport Loader from \"react-loader-spinner\";\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport './styles/styles.css';\nlet dimensions = appConfig.dimensions;\nconst MA_Day_5 = \"5 Day MA for \";\nconst LOWER_BAND = \"Lower Band for \";\nconst UPPER_BAND = \"Upper Band for \";\nconst HEADERS_GROWTH_RATES = [\"Growth_Rate_0_1\", \"Growth_Rate_0_2\", \"Growth_Rate_0_3\", \"Growth_Rate_1_2\", \"Growth_Rate_2_3\"];\nconst HEADERS_PROJECTED_GROWTH = [\"Projected growth in 5 weeks for US (for all keywords) [%]\", \"Projected growth in 5 weeks for US (for one keyword) [%]\"];\nconst ratio = 4.5;\nconst SECONDS_NUMBER = 60;\n\nclass App extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.fetchCallback = (keywords, selected_state_name, selected_time_frame) => {\n      this.setState({\n        displayResults: false,\n        region_state: selected_state_name.toUpperCase()\n      });\n      this.fetchData(keywords, selected_state_name, selected_time_frame);\n    };\n\n    this.errorCallback = message => {\n      this.setState({\n        displayError: true,\n        error_message: message\n      });\n      window.setTimeout(() => {\n        this.setState({\n          displayError: false\n        });\n      }, 2000);\n    };\n\n    this.mapCallback = state => {\n      this.setState({\n        displayResults: false,\n        region_state: state.toUpperCase()\n      });\n      this.fetchData(this.state.keywords, state, this.state.selected_time_frame);\n    };\n\n    this.toLoginCallback = () => {\n      // console.log(\"! \" + this.state.seconds)\n      this.timer = 0;\n      this.setState({\n        authenticated: true,\n        seconds: SECONDS_NUMBER\n      }); // if(this.state.authenticated) {\n      // this.startTimer();\n      // }\n    };\n\n    this.handleMouseMove = () => {\n      this.timer = 0;\n      this.setState({\n        seconds: SECONDS_NUMBER\n      }); // console.log(\"mouse moving\")\n    };\n\n    this.updateWindowDimensions = this.updateWindowDimensions.bind(this);\n    this.handleMouseMove = this.handleMouseMove.bind(this);\n    this.handleHoverOff = this.handleHoverOff.bind(this);\n    this.timer = 0;\n    this.startTimer = this.startTimer.bind(this);\n    this.countDown = this.countDown.bind(this);\n    this.state = {\n      username: \"user\",\n      authenticated: false,\n      displayResults: false,\n      fetching_results: false,\n      displayError: false,\n      region_state: \"US\",\n      selected_time_frame: \"today 5-y\",\n      keywords: [],\n      data: [],\n      rate_table_data: [],\n      growth_table_data: [],\n      error_message: \"\",\n      time: {},\n      seconds: SECONDS_NUMBER\n    };\n    this.myRef = React.createRef(); // this.startTimer();\n  }\n\n  fetchData(keywords, state, selected_time_frame) {\n    let url = \"/data\"; // let url = appConfig.KEYWORDS_DATA2\n\n    this.setState({\n      fetching_results: true,\n      keywords: keywords\n    });\n    fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-type': 'application/json'\n      },\n      body: JSON.stringify({\n        keywords: keywords,\n        region_state: state,\n        time_frame: selected_time_frame\n      })\n    }).then(res => res.json()).then(result => {\n      let width = this.myRef.current.offsetWidth;\n      let sizes = this.get_dimensions(width);\n      this.setState({\n        keywords: keywords,\n        displayResults: true,\n        fetching_results: false,\n        region_state: state.toUpperCase(),\n        selected_time_frame: selected_time_frame,\n        data: this.get_data2(keywords, result),\n        rate_table_data: this.getRateTableData(result.growth_rate_result),\n        growth_table_data: this.getGrowthTableData(result.projected_growth_result),\n        div_height: sizes.height,\n        width: width\n      });\n    }).catch(function (error) {\n      console.log(error);\n    });\n  }\n\n  componentDidMount() {\n    this.updateWindowDimensions();\n    window.addEventListener('resize', this.updateWindowDimensions);\n    this.myRef.current.focus();\n    let timeLeftVar = this.secondsToTime(this.state.seconds);\n    this.setState({\n      time: timeLeftVar\n    }); // this.countDown();\n    // if(this.state.authenticated) {\n    //   this.startTimer();\n    // }\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this.updateWindowDimensions);\n\n    if (!this.state.authenticated) {\n      this.setState({\n        seconds: SECONDS_NUMBER\n      });\n    }\n  }\n\n  startTimer() {\n    if (this.state.seconds === 0) {\n      this.setState({\n        authenticated: false,\n        seconds: SECONDS_NUMBER\n      });\n    }\n\n    console.log(this.timer);\n\n    if (this.timer == 0 && this.state.seconds > 0) {\n      this.timer = setInterval(this.countDown, 1000);\n    }\n  }\n\n  secondsToTime(secs) {\n    let hours = Math.floor(secs / (60 * 60));\n    let divisor_for_minutes = secs % (60 * 60);\n    let minutes = Math.floor(divisor_for_minutes / 60);\n    let divisor_for_seconds = divisor_for_minutes % 60;\n    let seconds = Math.ceil(divisor_for_seconds);\n    let obj = {\n      \"h\": hours,\n      \"m\": minutes,\n      \"s\": seconds\n    };\n    return obj;\n  }\n\n  countDown() {\n    // Remove one second, set state so a re-render happens.\n    let seconds = this.state.seconds - 1;\n    this.setState({\n      time: this.secondsToTime(seconds),\n      seconds: seconds\n    }); // Check if we're at zero.\n\n    if (seconds == 0) {\n      clearInterval(this.timer);\n      this.setState({\n        authenticated: false,\n        seconds: SECONDS_NUMBER\n      });\n    }\n  }\n\n  updateWindowDimensions() {\n    let width = this.myRef.current.offsetWidth;\n    let sizes = this.get_dimensions(width);\n    this.setState({\n      div_height: sizes.height,\n      width: width\n    });\n  }\n\n  handleHoverOff(event) {// console.log(\"mouse leaving\")\n  }\n\n  render() {\n    let plot_settings = {\n      title: \"Trends Forecast\",\n      x_label: \"Date\",\n      y_label: \"Search interest (%)\",\n      number_of_series: this.state.keywords.length,\n      keywords: this.state.keywords,\n      height: this.state.div_height,\n      width: this.state.width\n    };\n\n    if (this.state.authenticated) {\n      return React.createElement(\"div\", {\n        ref: this.myRef,\n        onMouseMove: this.handleMouseMove,\n        onMouseLeave: this.handleHoverOff,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 267\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"main_results\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 269\n        },\n        __self: this\n      }, React.createElement(Header, {\n        username: this.state.username,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 270\n        },\n        __self: this\n      }), React.createElement(Input, {\n        callbackFromParent: this.fetchCallback,\n        errorTimeframeCallback: this.errorCallback,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 271\n        },\n        __self: this\n      }), this.state.displayError ? React.createElement(\"div\", {\n        className: \"error_message\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 273\n        },\n        __self: this\n      }, this.state.error_message) : React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 273\n        },\n        __self: this\n      }, React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 273\n        },\n        __self: this\n      })), this.state.displayResults ? React.createElement(\"div\", {\n        className: \"content\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 277\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"results_div\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 278\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"map_div\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 279\n        },\n        __self: this\n      }, React.createElement(Chart, {\n        callbackFromApp: this.mapCallback,\n        height: this.state.div_height,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 280\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        id: \"plot_div\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 282\n        },\n        __self: this\n      }, React.createElement(KeywordPlot, {\n        plot_settings: plot_settings,\n        data: this.state.data,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 283\n        },\n        __self: this\n      }))), React.createElement(\"div\", {\n        className: \"tables\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 286\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"row\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 287\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"table-responsive result_table\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 288\n        },\n        __self: this\n      }, React.createElement(Table, {\n        tableData: this.state.rate_table_data,\n        title: \"Growth Rate\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 289\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"table-responsive result_table\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 291\n        },\n        __self: this\n      }, React.createElement(TableGrowth, {\n        tableData: this.state.growth_table_data,\n        title: \"Projected Growth\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 292\n        },\n        __self: this\n      }))))) : React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 298\n        },\n        __self: this\n      }, this.state.fetching_results ? React.createElement(\"div\", {\n        className: \"spinner\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 303\n        },\n        __self: this\n      }, React.createElement(Loader, {\n        type: \"Oval\",\n        color: \"#1694d0\",\n        height: 200,\n        width: 200,\n        timeout: 30000,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 304\n        },\n        __self: this\n      })) : React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 306\n        },\n        __self: this\n      })), React.createElement(Footer, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 310\n        },\n        __self: this\n      })));\n    } else {\n      return React.createElement(\"div\", {\n        ref: this.myRef,\n        onMouseMove: this.handleMouseMove,\n        onMouseLeave: this.handleHoverOff,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 316\n        },\n        __self: this\n      }, React.createElement(Login, {\n        callbackFromLogin: this.toLoginCallback,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 317\n        },\n        __self: this\n      }));\n    }\n  }\n\n  getGrowthTableData(data) {\n    let headers = [`Projected growth in 5 weeks for ${this.state.region_state} (for all keywords) [%]`, `Projected growth in 5 weeks for ${this.state.region_state} (for one keyword) [%]`];\n    let arr = Object.keys(data[\"Keyword\"]).map(function (key) {\n      return [capitalizeString(data[\"Keyword\"][key]), data[headers[0]][key], data[headers[1]][key]];\n    });\n    let result = {\n      data: arr,\n      // data: mock,\n      headers: headers\n    };\n    return result;\n  }\n\n  getRateTableData(data) {\n    let headers = HEADERS_GROWTH_RATES;\n    let table_headers = [\"Growth Rate 1\", \"Growth Rate 2\", \"Growth Rate 3\", \"Growth Rate 4\", \"Growth Rate 5\"];\n    let arr = Object.keys(data[\"Keyword\"]).map(function (key) {\n      return [capitalizeString(data[\"Keyword\"][key]), data[headers[0]][key], data[headers[1]][key], data[headers[2]][key], data[headers[3]][key], data[headers[4]][key]];\n    });\n    let result = {\n      data: arr,\n      headers: table_headers\n    };\n    return result;\n  }\n\n  get_data(keywords, result) {\n    let historical_data = [];\n    let forecasted_data = [];\n\n    for (let keyword in keywords) {\n      let index = 0;\n      let k_w = keywords[keyword];\n      let length = Object.keys(result[k_w]).length - 60;\n      console.log(Object.keys(result[k_w]).length);\n      let arr = Object.keys(result[k_w]).map(function (key) {\n        if (result[k_w][key] !== null) {\n          if (index < 4) {\n            return [index++, new Date(key).valueOf(), result[k_w][key], result[LOWER_BAND + k_w][key], result[UPPER_BAND + k_w][key]];\n          } else {\n            return [index++, new Date(key).valueOf(), result[MA_Day_5 + k_w][key], result[LOWER_BAND + k_w][key], result[UPPER_BAND + k_w][key]];\n          }\n        }\n      });\n      historical_data.push(arr.slice(0, index));\n      arr = Object.keys(result[keywords[keyword] + \"F\"]).map(function (key) {\n        if (index < 4) {\n          return [index++, new Date(key).valueOf(), result[keywords[keyword] + \"F\"][key], result[LOWER_BAND + k_w + \"F\"][key], result[UPPER_BAND + k_w + \"F\"][key]];\n        } else {\n          return [index++, new Date(key).valueOf(), result[MA_Day_5 + k_w + \"F\"][key], result[LOWER_BAND + k_w + \"F\"][key], result[UPPER_BAND + k_w + \"F\"][key]];\n        }\n      });\n      forecasted_data.push(arr.slice(length, length + 52));\n    }\n\n    return {\n      historical_data: historical_data,\n      forecasted_data: forecasted_data\n    };\n  }\n\n  get_data2(keywords, result) {\n    let historical_data = [];\n    let forecasted_data = [];\n\n    for (let keyword in keywords) {\n      let index = 0;\n      let k_w = keywords[keyword];\n      let length = Object.keys(result.historical_data).length;\n      let arr = Object.keys(result.historical_data).map(function (key) {\n        if (result.historical_data[key] !== null) {\n          if (index < 4) {\n            return [index++, new Date(key).valueOf(), result.historical_data[key][k_w].value, result.historical_data[key][k_w].L_B, result.historical_data[key][k_w].U_B];\n          } else {\n            return [index++, new Date(key).valueOf(), result.historical_data[key][k_w].M_A, result.historical_data[key][k_w].L_B, result.historical_data[key][k_w].U_B];\n          }\n        }\n      });\n      historical_data.push(arr.slice(0, index));\n      arr = Object.keys(result.forecasted_data).map(function (key) {\n        if (index < 4) {\n          return [index++, new Date(key).valueOf(), result.forecasted_data[key][k_w].value, result.forecasted_data[key][k_w].L_B, result.forecasted_data[key][k_w].U_B];\n        } else {\n          return [index++, new Date(key).valueOf(), result.forecasted_data[key][k_w].M_A, result.forecasted_data[key][k_w].L_B, result.forecasted_data[key][k_w].U_B];\n        }\n      });\n      forecasted_data.push(arr.slice(length, length + 52));\n    }\n\n    return {\n      historical_data: historical_data,\n      forecasted_data: forecasted_data\n    };\n  }\n\n  get_dimensions(width) {\n    let height = width / ratio;\n\n    if (width > 1800) {\n      height = height;\n    }\n\n    if (width <= 1800) {\n      height = 1.2 * width / ratio;\n    }\n\n    if (width <= 1600) {\n      height = 1.4 * width / ratio;\n    }\n\n    if (width <= 1400) {\n      height = 1.7 * width / ratio;\n    }\n\n    if (width <= 1200) {\n      height = 2.2 * width / ratio;\n    }\n\n    if (width <= 700) {\n      height = 3.4 * width / ratio;\n    }\n\n    let sizes = {\n      height: height\n    };\n    return sizes;\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["G:/kloud9/dashboard-last/trends-tool/client/src/App.js"],"names":["React","Header","Input","Login","Table","TableGrowth","Chart","Footer","KeywordPlot","appConfig","get_min_value","get_max_value","capitalizeString","Loader","dimensions","MA_Day_5","LOWER_BAND","UPPER_BAND","HEADERS_GROWTH_RATES","HEADERS_PROJECTED_GROWTH","ratio","SECONDS_NUMBER","App","PureComponent","constructor","props","fetchCallback","keywords","selected_state_name","selected_time_frame","setState","displayResults","region_state","toUpperCase","fetchData","errorCallback","message","displayError","error_message","window","setTimeout","mapCallback","state","toLoginCallback","timer","authenticated","seconds","handleMouseMove","updateWindowDimensions","bind","handleHoverOff","startTimer","countDown","username","fetching_results","data","rate_table_data","growth_table_data","time","myRef","createRef","url","fetch","method","headers","body","JSON","stringify","time_frame","then","res","json","result","width","current","offsetWidth","sizes","get_dimensions","get_data2","getRateTableData","growth_rate_result","getGrowthTableData","projected_growth_result","div_height","height","catch","error","console","log","componentDidMount","addEventListener","focus","timeLeftVar","secondsToTime","componentWillUnmount","removeEventListener","setInterval","secs","hours","Math","floor","divisor_for_minutes","minutes","divisor_for_seconds","ceil","obj","clearInterval","event","render","plot_settings","title","x_label","y_label","number_of_series","length","arr","Object","keys","map","key","table_headers","get_data","historical_data","forecasted_data","keyword","index","k_w","Date","valueOf","push","slice","value","L_B","U_B","M_A"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport Header from \"./components/Header\"\r\nimport Input from './components/Input'\r\nimport Login from './components/Login';\r\nimport Table from './components/Table';\r\nimport TableGrowth from './components/TableGrowth';\r\nimport Chart from './components/Chart';\r\nimport Footer from './components/Footer';\r\nimport KeywordPlot from './components/plot/index.js';\r\nimport { appConfig } from './config.js';\r\nimport { get_min_value, get_max_value, capitalizeString } from './components/plot/src/plot/utils/functions';\r\n\r\nimport Loader from \"react-loader-spinner\";\r\nimport 'bootstrap/dist/css/bootstrap.min.css';\r\nimport './styles/styles.css';\r\n\r\nlet dimensions = appConfig.dimensions;\r\n\r\nconst MA_Day_5 = \"5 Day MA for \";\r\nconst LOWER_BAND = \"Lower Band for \";\r\nconst UPPER_BAND = \"Upper Band for \";\r\n\r\nconst HEADERS_GROWTH_RATES = [\"Growth_Rate_0_1\", \"Growth_Rate_0_2\", \"Growth_Rate_0_3\", \"Growth_Rate_1_2\", \"Growth_Rate_2_3\"];\r\nconst HEADERS_PROJECTED_GROWTH = [\"Projected growth in 5 weeks for US (for all keywords) [%]\", \"Projected growth in 5 weeks for US (for one keyword) [%]\"];\r\nconst ratio = 4.5;\r\n\r\nconst SECONDS_NUMBER = 60;\r\n\r\nclass App extends React.PureComponent {\r\n  \r\n    constructor(props){\r\n      super(props);\r\n      this.updateWindowDimensions = this.updateWindowDimensions.bind(this);\r\n      this.handleMouseMove = this.handleMouseMove.bind(this);\r\n      this.handleHoverOff = this.handleHoverOff.bind(this);\r\n\r\n      this.timer = 0;\r\n      this.startTimer = this.startTimer.bind(this);\r\n      this.countDown = this.countDown.bind(this);\r\n\r\n      this.state = {\r\n        username: \"user\",\r\n        authenticated: false,\r\n        displayResults: false,\r\n        fetching_results: false,\r\n        displayError: false,\r\n\r\n        region_state: \"US\",\r\n        selected_time_frame: \"today 5-y\",\r\n        keywords: [],\r\n        data: [],\r\n        rate_table_data: [],\r\n        growth_table_data: [],\r\n        error_message: \"\",\r\n        \r\n        time: {},\r\n        seconds: SECONDS_NUMBER,\r\n      };\r\n\r\n      this.myRef = React.createRef();\r\n      // this.startTimer();\r\n    }\r\n\r\n    fetchCallback = (keywords, selected_state_name, selected_time_frame) => {\r\n      this.setState({\r\n          displayResults: false,\r\n          region_state: selected_state_name.toUpperCase(),\r\n      });\r\n\r\n      this.fetchData(keywords, selected_state_name, selected_time_frame)\r\n    }\r\n\r\n    errorCallback = (message) => {\r\n\r\n      this.setState({\r\n        displayError: true,\r\n        error_message: message,\r\n      });\r\n\r\n      window.setTimeout(() => {\r\n        this.setState({\r\n          displayError: false\r\n        });\r\n      }, 2000);\r\n\r\n    }\r\n\r\n    mapCallback = (state) => {\r\n\r\n      this.setState({\r\n        displayResults: false,\r\n        region_state: state.toUpperCase(),\r\n      });\r\n\r\n      this.fetchData(this.state.keywords, state, this.state.selected_time_frame)\r\n    }\r\n\r\n    fetchData(keywords, state, selected_time_frame){\r\n\r\n      let url = \"/data\"\r\n      // let url = appConfig.KEYWORDS_DATA2\r\n\r\n      this.setState({\r\n        fetching_results: true,\r\n        keywords: keywords\r\n      })\r\n\r\n      fetch(url, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-type':'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          keywords: keywords, region_state: state, time_frame: selected_time_frame\r\n        }),\r\n      }).then(res => res.json())\r\n        .then(\r\n        (result) => {\r\n          let width = this.myRef.current.offsetWidth;\r\n          let sizes = this.get_dimensions(width);\r\n\r\n          this.setState({\r\n            keywords: keywords,\r\n            displayResults: true,\r\n            fetching_results: false,\r\n\r\n            region_state: state.toUpperCase(),\r\n            selected_time_frame: selected_time_frame,\r\n\r\n            data: this.get_data2(keywords, result),\r\n            rate_table_data: this.getRateTableData(result.growth_rate_result),\r\n            growth_table_data: this.getGrowthTableData(result.projected_growth_result),\r\n            \r\n            div_height: sizes.height,\r\n            width: width,\r\n          });\r\n        }).catch(function(error) {\r\n        console.log(error)\r\n        })\r\n      }\r\n\r\n    componentDidMount() {\r\n      this.updateWindowDimensions();\r\n      window.addEventListener('resize', this.updateWindowDimensions);\r\n      this.myRef.current.focus();\r\n\r\n      let timeLeftVar = this.secondsToTime(this.state.seconds);\r\n      this.setState({ time: timeLeftVar });\r\n\r\n      // this.countDown();\r\n      // if(this.state.authenticated) {\r\n      //   this.startTimer();\r\n      // }\r\n    }\r\n\r\n    componentWillUnmount() {\r\n      window.removeEventListener('resize', this.updateWindowDimensions);\r\n      if(!this.state.authenticated) {\r\n        this.setState({\r\n          seconds: SECONDS_NUMBER,\r\n        })\r\n      }\r\n    }\r\n\r\n    startTimer() {\r\n      if(this.state.seconds === 0){\r\n        this.setState({\r\n          authenticated: false,\r\n          seconds: SECONDS_NUMBER,\r\n        })\r\n      }\r\n      console.log(this.timer)\r\n      if (this.timer == 0 && this.state.seconds > 0) {\r\n        this.timer = setInterval(this.countDown, 1000);\r\n      }\r\n    }\r\n\r\n    secondsToTime(secs){\r\n      let hours = Math.floor(secs / (60 * 60));\r\n  \r\n      let divisor_for_minutes = secs % (60 * 60);\r\n      let minutes = Math.floor(divisor_for_minutes / 60);\r\n  \r\n      let divisor_for_seconds = divisor_for_minutes % 60;\r\n      let seconds = Math.ceil(divisor_for_seconds);\r\n  \r\n      let obj = {\r\n        \"h\": hours,\r\n        \"m\": minutes,\r\n        \"s\": seconds\r\n      };\r\n      return obj;\r\n    }\r\n\r\n    countDown() {\r\n      // Remove one second, set state so a re-render happens.\r\n      let seconds = this.state.seconds - 1;\r\n      this.setState({\r\n        time: this.secondsToTime(seconds),\r\n        seconds: seconds,\r\n      });\r\n      \r\n      // Check if we're at zero.\r\n      if (seconds == 0) { \r\n        clearInterval(this.timer);\r\n        this.setState({\r\n          authenticated: false,\r\n          seconds: SECONDS_NUMBER,\r\n        })\r\n      }\r\n    }\r\n    \r\n    updateWindowDimensions() {\r\n      let width = this.myRef.current.offsetWidth;\r\n      let sizes = this.get_dimensions(width);\r\n\r\n      this.setState({\r\n        div_height: sizes.height,\r\n        width: width,\r\n      });\r\n    }\r\n\r\n    toLoginCallback =() => {\r\n      // console.log(\"! \" + this.state.seconds)\r\n      this.timer=0;\r\n      this.setState({\r\n        authenticated: true,\r\n        seconds: SECONDS_NUMBER,\r\n        \r\n      });\r\n      // if(this.state.authenticated) {\r\n        // this.startTimer();\r\n      // }\r\n    }\r\n\r\n    // onDragEndCircle = () => {\r\n    handleMouseMove= () => {\r\n      this.timer = 0;\r\n      this.setState({\r\n        seconds: SECONDS_NUMBER,\r\n      });\r\n      // console.log(\"mouse moving\")\r\n    }\r\n\r\n    handleHoverOff(event) {\r\n      // console.log(\"mouse leaving\")\r\n    }\r\n\r\n    render() {\r\n\r\n      let plot_settings = {\r\n        title: \"Trends Forecast\",\r\n        x_label: \"Date\",\r\n        y_label: \"Search interest (%)\",\r\n\r\n        number_of_series: this.state.keywords.length,\r\n        keywords: this.state.keywords,\r\n\r\n        height: this.state.div_height,\r\n        width: this.state.width\r\n\r\n      }\r\n\r\n      if (this.state.authenticated) {\r\n\r\n        return (\r\n          <div ref={this.myRef} onMouseMove={this.handleMouseMove} onMouseLeave={this.handleHoverOff}>\r\n            \r\n            <div className=\"main_results\">\r\n              <Header username={this.state.username} />\r\n              <Input callbackFromParent={this.fetchCallback} errorTimeframeCallback={this.errorCallback} />\r\n\r\n              { (this.state.displayError) ? (<div className=\"error_message\">{this.state.error_message}</div>) : (<div><br/></div>)}\r\n\r\n            { (this.state.displayResults) ? (\r\n            \r\n            <div className=\"content\">\r\n              <div className=\"results_div\">\r\n                <div className=\"map_div\">\r\n                  <Chart callbackFromApp={this.mapCallback} height={this.state.div_height} />\r\n                </div>\r\n                <div id=\"plot_div\"> \r\n                  <KeywordPlot plot_settings={plot_settings} data={this.state.data} />\r\n                </div>\r\n              </div>\r\n              <div className=\"tables\">\r\n                <div className=\"row\">\r\n                  <div className=\"table-responsive result_table\">\r\n                    <Table tableData={this.state.rate_table_data} title={\"Growth Rate\"}/>\r\n                  </div>\r\n                  <div className=\"table-responsive result_table\">\r\n                    <TableGrowth tableData={this.state.growth_table_data} title={\"Projected Growth\"} />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>  ) : (\r\n            \r\n            <div>\r\n              {/* <div className=\"intro\">\r\n\r\n              </div> */}\r\n              {this.state.fetching_results ? (    \r\n                <div className=\"spinner\">\r\n                  <Loader type=\"Oval\" color=\"#1694d0\" height={200} width={200} timeout={30000} />\r\n                </div>   \r\n                ) : (<div></div>) }\r\n            </div>\r\n            )\r\n          }\r\n          <Footer />\r\n          </div>\r\n        </div>\r\n      );\r\n      } else {\r\n        return (\r\n          <div ref={this.myRef} onMouseMove={this.handleMouseMove} onMouseLeave={this.handleHoverOff}>\r\n            <Login callbackFromLogin={this.toLoginCallback} />\r\n          </div>\r\n        );      \r\n      }\r\n    }\r\n    \r\n    getGrowthTableData(data) {\r\n      let headers = [`Projected growth in 5 weeks for ${this.state.region_state} (for all keywords) [%]`, `Projected growth in 5 weeks for ${this.state.region_state} (for one keyword) [%]`]\r\n      \r\n      let arr = Object.keys(data[\"Keyword\"]).map(\r\n        \r\n        function(key){\r\n          return [capitalizeString(data[\"Keyword\"][key]), data[headers[0]][key], data[headers[1]][key]]\r\n        }\r\n      );\r\n\r\n      let result = {\r\n        data: arr,\r\n        // data: mock,\r\n        headers: headers\r\n      }\r\n  \r\n      return result;\r\n    }\r\n    \r\n    getRateTableData(data) {\r\n      let headers = HEADERS_GROWTH_RATES;\r\n      let table_headers = [\"Growth Rate 1\", \"Growth Rate 2\", \"Growth Rate 3\", \"Growth Rate 4\", \"Growth Rate 5\"]\r\n      let arr = Object.keys(data[\"Keyword\"]).map(\r\n        function(key){\r\n          return [capitalizeString(data[\"Keyword\"][key]), data[headers[0]][key], data[headers[1]][key], data[headers[2]][key], data[headers[3]][key], data[headers[4]][key]]\r\n        }\r\n      );\r\n\r\n      let result = {\r\n        data: arr,\r\n        headers: table_headers\r\n      }\r\n  \r\n      return result;\r\n    }\r\n\r\n      get_data(keywords, result) {\r\n        let historical_data = []\r\n        let forecasted_data = []\r\n\r\n        for (let keyword in keywords) {  \r\n          let index = 0;\r\n          let k_w = keywords[keyword]\r\n          let length = Object.keys(result[k_w]).length - 60;\r\n          console.log(Object.keys(result[k_w]).length)\r\n          \r\n          let arr = Object.keys(result[k_w]).map(\r\n            function(key) {\r\n              if(result[k_w][key] !== null){\r\n                if (index < 4) {\r\n                  return [index++, new Date(key).valueOf(), result[k_w][key], result[LOWER_BAND+k_w][key], result[UPPER_BAND+k_w][key]]\r\n                } else {\r\n                  return [index++, new Date(key).valueOf(), result[MA_Day_5+k_w][key], result[LOWER_BAND+k_w][key], result[UPPER_BAND+k_w][key]]\r\n                }\r\n              } \r\n            }\r\n          );\r\n\r\n          historical_data.push(arr.slice(0, index))\r\n\r\n          arr = Object.keys(result[keywords[keyword] + \"F\"]).map(\r\n            function(key) {\r\n              if (index < 4) {\r\n                return [index++, new Date(key).valueOf(), result[keywords[keyword] + \"F\"][key], result[LOWER_BAND+k_w+ \"F\"][key], result[UPPER_BAND + k_w + \"F\"][key]]            \r\n              } else {\r\n                return [index++, new Date(key).valueOf(), result[MA_Day_5 + k_w + \"F\"][key], result[LOWER_BAND + k_w + \"F\"][key], result[UPPER_BAND + k_w + \"F\"][key]]\r\n              }\r\n            }\r\n          );\r\n\r\n          forecasted_data.push(arr.slice(length, length + 52))\r\n        }\r\n\r\n        return {\r\n          historical_data: historical_data,\r\n          forecasted_data: forecasted_data\r\n        }\r\n\r\n      }\r\n\r\n      get_data2(keywords, result) {\r\n        let historical_data = []\r\n        let forecasted_data = []\r\n\r\n        for (let keyword in keywords) {  \r\n          let index = 0;\r\n          let k_w = keywords[keyword]\r\n          let length = Object.keys(result.historical_data).length\r\n\r\n          \r\n          let arr = Object.keys(result.historical_data).map(\r\n            function(key) {\r\n              if(result.historical_data[key] !== null){\r\n                if (index < 4) {\r\n                  return [index++, new Date(key).valueOf(), result.historical_data[key][k_w].value, result.historical_data[key][k_w].L_B, result.historical_data[key][k_w].U_B]\r\n                } else {\r\n                  return [index++, new Date(key).valueOf(), result.historical_data[key][k_w].M_A, result.historical_data[key][k_w].L_B, result.historical_data[key][k_w].U_B]\r\n                }\r\n              } \r\n            }\r\n          );\r\n  \r\n          historical_data.push(arr.slice(0, index))\r\n  \r\n          arr = Object.keys(result.forecasted_data).map(\r\n            function(key) {\r\n              if (index < 4) {\r\n                return [index++, new Date(key).valueOf(), result.forecasted_data[key][k_w].value, result.forecasted_data[key][k_w].L_B, result.forecasted_data[key][k_w].U_B]\r\n              } else {\r\n                return [index++, new Date(key).valueOf(), result.forecasted_data[key][k_w].M_A, result.forecasted_data[key][k_w].L_B, result.forecasted_data[key][k_w].U_B]\r\n              }\r\n            }\r\n          );\r\n  \r\n          forecasted_data.push(arr.slice(length, length + 52))\r\n        }\r\n\r\n        return {\r\n          historical_data: historical_data,\r\n          forecasted_data: forecasted_data\r\n        }\r\n  \r\n      }\r\n\r\n  get_dimensions(width) {\r\n    let height = width/(ratio);\r\n\r\n    if (width>1800) {\r\n      height = height;\r\n    }\r\n\r\n    if (width<=1800) {\r\n      height = (1.2)*width/(ratio);\r\n    }\r\n\r\n    if (width<=1600) {\r\n      height = (1.4)*width/(ratio);\r\n    }\r\n    \r\n    if (width<=1400) {\r\n      height = (1.7)*width/(ratio);\r\n    }\r\n\r\n    if (width<=1200) {\r\n      height = (2.2)*width/(ratio);\r\n    }\r\n\r\n    if (width<=700) {\r\n      height = (3.4)*width/(ratio);\r\n    }\r\n\r\n    let sizes = {\r\n      height: height,\r\n    }\r\n\r\n    return sizes;\r\n  }\r\n}\r\n  \r\n  \r\nexport default App;\r\n"]},"metadata":{},"sourceType":"module"}